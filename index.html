<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Hello World in Backbone.js</title>
</head>
<body>
  <!-- ========= -->
  <!-- Your HTML -->
  <!-- ========= -->

  
  <div id="leaderboard_app">
  	<ul id="leaderboard_list"></ul>
  
  </div>
  
  
  
  <script type="text/template" id="leaderboard-item-tmpl">
	  <p><a href="/user/<%= userId %>"><%= username %></a></p>
	  <p>Rank: <i><%= rank %></i></p>
	  <button class="remove">x</button>
	</script>
  
  <!-- ========= -->
  <!-- Libraries -->
  <!-- ========= -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js" type="text/javascript"></script>
  <!--<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone-localstorage.js/1.0/backbone.localStorage-min.js" type="text/javascript"></script>  -->
  
  <!-- =============== -->
  <!-- Javascript code -->
  <!-- =============== -->
  <script type="text/javascript">
	   var app = {}; // create namespace for our app

    var LeaderboardModel = Backbone.Model.extend({
		defaults: {
			userId: null,
			username: null,
			rank: null
		}

    });
    
    var LeaderboardCollection = Backbone.Collection.extend({
	    model: LeaderboardModel,
	    url: 'https://apis.trainheroic.com/public/leaderboard/468425',
		parse: function(data){
			return data.results;
		}
    })
    
   /*
    var LB = new LeaderboardCollection();
    LB.fetch().then(function(){
	    console.log(LB.length);
	    var tank = LB.at(1);
	    //console.log(tank);
	    LB.each(function(LB){
		   //console.log(LB); 
	    });

    })
	 */ 
	
	var LeaderboardListItemView = Backbone.View.extend({
	  tagName: 'li',
	  className: 'athlete',
	  template: _.template($('#leaderboard-item-tmpl').html()),
	  
	  initialize: function() {
	    //this.listenTo(this.model, 'sync change', this.render);
	    //this.collection.fetch();
	    //this.render();
	  },
	
	  render: function() {
		var html = this.template(this.model.toJSON());
		//console.log(html);
		//console.log($el);
	   	this.$el.html(html);
	   	return this;
	  }
	  
	});
	
	var LeaderboardListView = Backbone.View.extend({
		el: '#leaderboard_app',
		
		 initialize: function() {
		    this.listenTo(this.collection, 'sync', this.render);
		    this.render();
		  },
		  
		  render: function() {
		    var $list = this.$('ul.leaderboard_list').empty();
		
		    this.collection.each(function(model) {
		      var item = new LeaderboardListItemView({model: model});
		      $list.append(item.render().$el);
		    }, this);
		
		    return this;
		  }
		  
	})
	
	var leaderboardList = new LeaderboardCollection();
	var leaderboardView = new LeaderboardListView({collection: leaderboardList});
	leaderboardList.fetch();
	
	
	  

  </script>
  
</body>
</html>